{"ts":1368349596922,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"angular.module('SharedServices', [])\n.config(function ($httpProvider) {\n    $httpProvider.responseInterceptors.push('myHttpInterceptor');\n    var spinnerFunction = function (data, headersGetter) {\n        // todo start the spinner here\n        //alert('done0');            \n        $('#loading').show();\n        return data;\n    };\n    $httpProvider.defaults.transformRequest.push(spinnerFunction);\n})\n// register the interceptor as a service, intercepts ALL angular ajax http calls\n.factory('myHttpInterceptor', function ($q, $window) {\n    return function (promise) {\n        return promise.then(function (response) { //success\n            // do something on success\n            // todo hide the spinner\n            //alert('done1');\n            $('#loading').hide();\n            return response;\n\n        }, function (response) { //error\n            // do something on error\n            // todo hide the spinner\n            //alert('done2');\n            $('#loading').hide();\n            return $q.reject(response);\n        });\n    };\n});\n\n\nvar app = angular.module(\"app\", ['mongolabResourceHttp','SharedServices']);\n\napp.constant('MONGOLAB_CONFIG',{API_KEY:'50aa141ce4b0021e6aceebc0', DB_NAME:'poetry'});\n\napp.factory('Poetry', function ($mongolabResourceHttp) {\n    return $mongolabResourceHttp('poems');\n});\n\napp.controller(\"PoetryCtrl\", function ($scope, Poetry) {\t\n\n\t$scope.queryObject = {\n\t\t\t\t\t\t\ttype:'', \n\t\t\t\t\t\t\tqry : {},\n\t\t\t\t\t\t\tpage_size : 10,\n\t\t\t\t\t\t\tpage_num: 1,\n\t\t\t\t\t\t\tsort : {sort: {serial:1}}\n\t\t\t\t\t\t};\n\n    $scope.poems = [\n                    {\"author\":\"valluvar\",\"explanation\":\"As all letters have the letter A for their first, so the world has the eternal God for its first. \",\"name\":\"thirukkural\",\"serial\":1,\"tags\":[\"thirukkural\",\"valluvar\",\"அறத்துப்பால்\",\"கடவுள் வாழ்த்து\"],\"text\":[\"அகர முதல எழுத்தெல்லாம் ஆதி\",\"பகவன் முதற்றே உலகு.\"],\"translation\":\"A, as its first of letters, every speech maintains; <br>The \\\"Primal Deity\\\" is first through all the world's domains. \",\"urlkey\":\"kural\"}\n                   ];                \n\n    $scope.pluralizer = {\n        0: \"No poems found.\",\n        1: \"One poem found.\",\n        other: \"{} poems found.\"\n    };\n\n    $scope.search = function () {\n\n        var term = $scope.term;\n        if (term.indexOf(\"tags:\") > -1) {\n            $scope.searchTags(term);\n            return;            \n        }\n\n        var searchSerial = term.match(/(\\D+) (\\d+)/);\n        if ( searchSerial ) {            \n            $scope.searchBySerial(searchSerial[1], parseInt(searchSerial[2]))\n            return;\n        }        \n\n        $scope.searchTerms();\n    };\n\n    $scope.searchTerms = function () {\n    \tPoetry.query({text:{\"$regex\":$scope.term,\"$options\":\"i\"}}, $scope.queryObject.sort)\n    \t.then(function (poems) {\n    \t\t$scope.poems = poems;\n    \t})\n        //$scope.poems = Poetry.byTerm.query({so : 1, term : $scope.term});    \n    };\n\n    $scope.searchTags = function (tags) {\n        tagArray = tags.replace(\"tags:\",\"\").trim().split(\",\");\n        \n        for (var i = 0; i < tagArray.length; i++) {\n          \ttagArray[i] = tagArray[i].trim();\n        };          \n        console.log(tagArray);\n\n        Poetry.query({tags:{\"$all\":tagArray}}, {sort: {serial:1}})\n        .then(function (poems) {\n        \tconsole.log(poems.length);\n        \t$scope.poems = poems;\n        })\n    };\n\n    $scope.searchBySerial = function (urlkey, serial) {\n    \tPoetry.query({urlkey:urlkey, serial:serial}, {sort: {serial:1}})\n    \t.then(function (poems) {\n    \t\t$scope.poems = poems;\n    \t})\n    };\n\n    $scope.fetchAllTags = function () {    \t\n    \tPoetry.distinct(\"tags\",{})\n    \t.then(function (all_tags) {\n    \t\t$scope.all_tags = all_tags;\n    \t})\n    };\n\n    \n    DB = $scope.poems;\n\n});"]],"start1":0,"start2":0,"length1":0,"length2":3738}]],"length":3738}
{"contributors":[],"silentsave":false,"ts":1368349682443,"patch":[[{"diffs":[[0,"ial[2]))"],[1,";"],[0,"\n"],[-1,""],[0,"        "]],"start1":2528,"start2":2528,"length1":17,"length2":18},{"diffs":[[0,"erms();\n    };\n\n"],[-1,"  "],[0,"  $scope.searchT"]],"start1":2599,"start2":2599,"length1":34,"length2":32},{"diffs":[[0,"nction () {\n    "],[-1,"\t"],[0,"Poetry.query({te"]],"start1":2640,"start2":2640,"length1":33,"length2":32},{"diffs":[[0,"t.sort)\n    "],[-1,"\t"],[0,".then(functi"]],"start1":2732,"start2":2732,"length1":25,"length2":24},{"diffs":[[0,"n (poems) {\n    "],[-1,"\t\t"],[1,"  "],[0,"$scope.poems = p"]],"start1":2757,"start2":2757,"length1":34,"length2":34},{"diffs":[[0,"ms;\n    "],[-1,"\t"],[0,"})"],[1,";"],[0,"\n"],[-1,"  "],[0,"      //"]],"start1":2793,"start2":2793,"length1":22,"length2":20},{"diffs":[[0,"});    \n"],[-1,"  "],[0,"  };\n\n  "]],"start1":2875,"start2":2875,"length1":18,"length2":16},{"diffs":[[0,"tags) {\n"],[-1,""],[0,"        "],[1,"var "],[0,"tagArray"]],"start1":2923,"start2":2923,"length1":24,"length2":28}]],"length":3735,"saved":false}
{"ts":1368349938298,"patch":[[{"diffs":[[0,"found.\"\n    };\n\n"],[-1,"  "],[0,"  $scope.search "]],"start1":2158,"start2":2158,"length1":34,"length2":32},{"diffs":[[0,"() {\n\n      "],[-1,"  "],[0,"var term = $"]],"start1":2201,"start2":2201,"length1":26,"length2":24},{"diffs":[[0,"e.term;\n"],[-1,"  "],[0,"      if"]],"start1":2229,"start2":2229,"length1":18,"length2":16},{"diffs":[[0,"-1) {\n          "],[-1,"  "],[0,"$scope.searchTag"]],"start1":2271,"start2":2271,"length1":34,"length2":32},{"diffs":[[0,";\n          "],[-1,"  "],[0,"return;     "]],"start1":2310,"start2":2310,"length1":26,"length2":24},{"diffs":[[0,"    "],[-1," "],[-1," "],[0,"}\n\n"],[-1,"  "],[0,"    "]],"start1":2344,"start2":2344,"length1":15,"length2":11},{"diffs":[[0,"\\d+)/);\n"],[-1,"  "],[0,"      if"]],"start1":2395,"start2":2395,"length1":18,"length2":16},{"diffs":[[0,"     \n          "],[-1,"  "],[0,"$scope.searchByS"]],"start1":2437,"start2":2437,"length1":34,"length2":32},{"diffs":[[0,";\n          "],[-1,"  "],[0,"return;\n    "]],"start1":2518,"start2":2518,"length1":26,"length2":24},{"diffs":[[0,"    "],[1,"}"],[0,"  "],[-1,"}"],[0,"  "],[1,"    \n"],[0,"      \n"],[-1,"\n  "],[0,"    "]],"start1":2540,"start2":2540,"length1":23,"length2":25},{"diffs":[[0,"erms();\n"],[-1,"  "],[0,"  };\n\n  "]],"start1":2581,"start2":2581,"length1":18,"length2":16},{"diffs":[[0,";    \n  };\n\n"],[-1,"  "],[0,"  $scope.sea"]],"start1":2857,"start2":2857,"length1":26,"length2":24},{"diffs":[[0,"on (tags) {\n"],[-1,"  "],[0,"      var ta"]],"start1":2897,"start2":2897,"length1":26,"length2":24},{"diffs":[[0,";\n      "],[-1,"  "],[0,"\n      "],[-1,"  "],[0,"for (var"]],"start1":2972,"start2":2972,"length1":27,"length2":23},{"diffs":[[0,"        "],[-1,"  \t"],[0,"tagArray"]],"start1":3031,"start2":3031,"length1":19,"length2":16},{"diffs":[[0,"    "],[-1,"  }; "],[1,"}"],[0,"    "]],"start1":3075,"start2":3075,"length1":13,"length2":9},{"diffs":[[0," }         \n"],[-1,"  "],[0,"      consol"]],"start1":3078,"start2":3078,"length1":26,"length2":24},{"diffs":[[0,"\n\n      "],[-1,"  "],[0,"Poetry.q"]],"start1":3118,"start2":3118,"length1":18,"length2":16},{"diffs":[[0,")\n      "],[-1,"  "],[0,".then(fu"]],"start1":3183,"start2":3183,"length1":18,"length2":16},{"diffs":[[0,"        "],[-1,"\t"],[0,"console."]],"start1":3216,"start2":3216,"length1":17,"length2":16},{"diffs":[[0,"        "],[-1,"\t"],[0,"$scope.p"]],"start1":3251,"start2":3251,"length1":17,"length2":16},{"diffs":[[0,"    "],[-1,"  })\n "],[1,"});\n"],[0,"  "],[-1," "],[0,"};\n\n"],[-1,"  "],[0,"  $s"]],"start1":3283,"start2":3283,"length1":23,"length2":18},{"diffs":[[0,"rial) {\n    "],[-1,"\t"],[0,"Poetry.query"]],"start1":3343,"start2":3343,"length1":25,"length2":24},{"diffs":[[0,"al:1}})\n    "],[-1,"\t"],[0,".then(functi"]],"start1":3412,"start2":3412,"length1":25,"length2":24},{"diffs":[[0,"oems) {\n    "],[-1,"\t\t"],[1,"  "],[0,"$scope.poems"]],"start1":3441,"start2":3441,"length1":26,"length2":26},{"diffs":[[0,"ms;\n    "],[-1,"\t"],[0,"})"],[1,";"],[0,"\n"],[-1," "],[0,"  "],[-1," "],[0,"};\n\n"],[-1,"  "],[0,"  $scope"]],"start1":3473,"start2":3473,"length1":30,"length2":26},{"diffs":[[0,"  \t\n    "],[-1,"\t"],[0,"Poetry.d"]],"start1":3530,"start2":3530,"length1":17,"length2":16},{"diffs":[[0,"{})\n    "],[-1,"\t"],[0,".then(fu"]],"start1":3561,"start2":3561,"length1":17,"length2":16},{"diffs":[[0,") {\n    "],[1," "],[-1,"\t\t"],[1," "],[0,"$scope.a"]],"start1":3593,"start2":3593,"length1":18,"length2":18},{"diffs":[[0,"    "],[-1,"\t"],[0,"})"],[1,";"],[0,"\n"],[-1,"  "],[0,"  };"]],"start1":3631,"start2":3631,"length1":14,"length2":12}]],"length":3677,"saved":false}
{"ts":1368349980973,"patch":[[{"diffs":[[0,"() {"],[-1,"    \t"],[0,"\n   "]],"start1":3524,"start2":3524,"length1":13,"length2":8}]],"length":3672,"saved":false}
{"ts":1368350016317,"patch":[[{"diffs":[[0,"ess\n"],[-1,"            // todo hide the spinner\n            //alert('done1');\n"],[0,"    "]],"start1":665,"start2":665,"length1":75,"length2":8},{"diffs":[[0,"ror\n"],[-1,"            // todo hide the spinner\n            //alert('done2');\n"],[0,"    "]],"start1":807,"start2":807,"length1":75,"length2":8}]],"length":3538,"saved":false}
{"ts":1368350020793,"patch":[[{"diffs":[[0,"here"],[-1,"\n        //alert('done0');  "],[0,"    "]],"start1":231,"start2":231,"length1":36,"length2":8}]],"length":3510,"saved":false}
